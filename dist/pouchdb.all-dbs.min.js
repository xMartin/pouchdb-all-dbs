!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.PouchDBAllDBs=t()}}(function(){return function(){function t(e,n,r){function o(u,c){if(!n[u]){if(!e[u]){var s="function"==typeof require&&require;if(!c&&s)return s(u,!0);if(i)return i(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var a=n[u]={exports:{}};e[u][0].call(a.exports,function(t){return o(e[u][1][t]||t)},a,a.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}return t}()({1:[function(t,e,n){(function(e){"use strict";var r=t("pouchdb-promise");n.once=function(t){var e=!1;return n.getArguments(function(n){if(e)throw console.trace(),new Error("once called  more than once");e=!0,t.apply(this,n)})},n.getArguments=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=-1;++r<e;)n[r]=arguments[r];return t.call(this,n)}},n.toPromise=function(t){return n.getArguments(function(o){var i,u=this,c="function"==typeof o[o.length-1]&&o.pop();c&&(i=function(t,n){e.nextTick(function(){c(t,n)})});var s=new r(function(e,r){try{var i=n.once(function(t,n){t?r(t):e(n)});o.push(i),t.apply(u,o)}catch(t){r(t)}});return i&&s.then(function(t){i(null,t)},i),s.cancel=function(){return this},s})},n.inherits=t("inherits")}).call(this,t("_process"))},{_process:8,inherits:5,"pouchdb-promise":6}],2:[function(t,e,n){(function(n,r){"use strict";function o(){this.queue=new u,this.running=!1}var i=t("argsarray"),u=t("tiny-queue"),c=r.setImmediate||n.nextTick;o.prototype.add=function(t,e){e=e||function(){},this.queue.push({fun:t,callback:e}),this.processNext()},o.prototype.processNext=function(){var t=this;if(!t.running&&t.queue.length){t.running=!0;var e=t.queue.shift();c(function(){e.fun(i(function(n){e.callback.apply(null,n),t.running=!1,t.processNext()}))})}},e.exports=o}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:8,argsarray:3,"tiny-queue":9}],3:[function(t,e,n){"use strict";function r(t){return function(){var e=arguments.length;if(e){for(var n=[],r=-1;++r<e;)n[r]=arguments[r];return t.call(this,n)}return t.call(this,[])}}e.exports=r},{}],4:[function(t,e,n){(function(t){"use strict";function n(){a=!0;for(var t,e,n=l.length;n;){for(e=l,l=[],t=-1;++t<n;)e[t]();n=l.length}a=!1}function r(t){1!==l.push(t)||a||o()}var o,i=t.MutationObserver||t.WebKitMutationObserver;if(i){var u=0,c=new i(n),s=t.document.createTextNode("");c.observe(s,{characterData:!0}),o=function(){s.data=u=++u%2}}else if(t.setImmediate||void 0===t.MessageChannel)o="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(n,0)};else{var f=new t.MessageChannel;f.port1.onmessage=n,o=function(){f.port2.postMessage(0)}}var a,l=[];e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],6:[function(t,e,n){"use strict";var r=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(t("lie")),o="function"==typeof Promise?Promise:r;e.exports=o},{lie:7}],7:[function(t,e,n){"use strict";function r(){}function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,t!==r&&s(this,t)}function i(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(t,e,n){d(function(){var r;try{r=e(n)}catch(e){return v.reject(t,e)}r===t?v.reject(t,new TypeError("Cannot resolve promise with itself")):v.resolve(t,r)})}function c(t){var e=t&&t.then;if(t&&"object"==typeof t&&"function"==typeof e)return function(){e.apply(t,arguments)}}function s(t,e){function n(e){i||(i=!0,v.reject(t,e))}function r(e){i||(i=!0,v.resolve(t,e))}function o(){e(r,n)}var i=!1,u=f(o);"error"===u.status&&n(u.value)}function f(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}function a(t){return t instanceof this?t:v.resolve(new this(r),t)}function l(t){var e=new this(r);return v.reject(e,t)}function h(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,o=!1;if(!n)return this.resolve([]);for(var i=new Array(n),u=0,c=-1,s=new this(r);++c<n;)!function(t,r){function c(t){i[r]=t,++u!==n||o||(o=!0,v.resolve(s,i))}e.resolve(t).then(c,function(t){o||(o=!0,v.reject(s,t))})}(t[c],c);return s}function p(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,o=!1;if(!n)return this.resolve([]);for(var i=-1,u=new this(r);++i<n;)!function(t){e.resolve(t).then(function(t){o||(o=!0,v.resolve(u,t))},function(t){o||(o=!0,v.reject(u,t))})}(t[i]);return u}var d=t("immediate"),v={},y=["REJECTED"],m=["FULFILLED"],w=["PENDING"];e.exports=o,o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===m||"function"!=typeof e&&this.state===y)return this;var n=new this.constructor(r);if(this.state!==w){u(n,this.state===m?t:e,this.outcome)}else this.queue.push(new i(n,t,e));return n},i.prototype.callFulfilled=function(t){v.resolve(this.promise,t)},i.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},i.prototype.callRejected=function(t){v.reject(this.promise,t)},i.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},v.resolve=function(t,e){var n=f(c,e);if("error"===n.status)return v.reject(t,n.value);var r=n.value;if(r)s(t,r);else{t.state=m,t.outcome=e;for(var o=-1,i=t.queue.length;++o<i;)t.queue[o].callFulfilled(e)}return t},v.reject=function(t,e){t.state=y,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},o.resolve=a,o.reject=l,o.all=h,o.race=p},{immediate:4}],8:[function(t,e,n){function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(t){if(l===setTimeout)return setTimeout(t,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function u(t){if(h===clearTimeout)return clearTimeout(t);if((h===o||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function c(){y&&d&&(y=!1,d.length?v=d.concat(v):m=-1,v.length&&s())}function s(){if(!y){var t=i(c);y=!0;for(var e=v.length;e;){for(d=v,v=[];++m<e;)d&&d[m].run();m=-1,e=v.length}d=null,y=!1,u(t)}}function f(t,e){this.fun=t,this.array=e}function a(){}var l,h,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(t){l=r}try{h="function"==typeof clearTimeout?clearTimeout:o}catch(t){h=o}}();var d,v=[],y=!1,m=-1;p.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];v.push(new f(t,e)),1!==v.length||y||i(s)},f.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=a,p.addListener=a,p.once=a,p.off=a,p.removeListener=a,p.removeAllListeners=a,p.emit=a,p.prependListener=a,p.prependOnceListener=a,p.listeners=function(t){return[]},p.binding=function(t){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(t){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],9:[function(t,e,n){"use strict";function r(){this.length=0}r.prototype.push=function(t){var e={item:t};this.last?this.last=this.last.next=e:this.last=this.first=e,this.length++},r.prototype.shift=function(){var t=this.first;if(t)return this.first=t.next,--this.length||(this.last=void 0),t.item},r.prototype.slice=function(t,e){t=void 0===t?0:t,e=void 0===e?1/0:e;for(var n=[],r=0,o=this.first;o&&!(--e<0);o=o.next)++r>t&&n.push(o.item);return n},e.exports=r},{}],10:[function(t,e,n){"use strict";function r(t){return c+t}function o(t){return t.slice(c.length)}var i=t("./pouch-utils"),u=t("./taskqueue"),c="db_";e.exports=function(t,e){function n(t){t&&console.error(t)}function s(){d.add(function(e){if(l)return e();l=new t(p),e()})}function f(t){return t.replace(/^_pouch_/,"")}function a(t){return t===p||-1!==t.indexOf("-mrview-")||/^https?:\/\//.test(t)}e=e||{};var l,h,p="pouch__all_dbs__",d=new u;t.on("created",function(t){t=f(t),a(t)||(t=r(t),s(),d.add(function(e){l.get(t).then(function(){}).catch(function(e){if("not_found"!==e.name)throw e;return l.put({_id:t})}).then(function(){h&&(h[t]=!0),e()},e)},n))}),t.on("destroyed",function(t){t=f(t),a(t)||(t=r(t),s(),d.add(function(e){l.get(t).then(function(t){return l.remove(t)}).catch(function(t){if("not_found"!==t.name)throw t}).then(function(){h&&delete h[t],e()},e)},n))}),t.allDbs=i.toPromise(function(t){s(),d.add(function(t){if(h&&!e.noCache)return t(null,Object.keys(h).map(o));var n={startkey:c,endkey:c+"ï¿¿"};l.allDocs(n).then(function(e){h={};var n=[];e.rows.forEach(function(t){n.push(o(t.key)),h[t.key]=!0}),t(null,n)}).catch(function(e){console.error(e),t(e)})},t)}),t.resetAllDbs=i.toPromise(function(t){d.add(function(t){l.destroy().then(function(){l=null,h=null,t()}).catch(function(e){console.error(e),t(e)})},t)})},"undefined"!=typeof window&&window.PouchDB&&e.exports(window.PouchDB)},{"./pouch-utils":1,"./taskqueue":2}]},{},[10])(10)});
